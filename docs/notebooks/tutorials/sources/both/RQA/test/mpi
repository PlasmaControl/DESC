#!/bin/bash
#SBATCH --job-name=bn_res_vec        # Job name
#SBATCH --output=bn_res_vec.%j.out   # Standard output
#SBATCH --error=bn_res_vec.%j.err    # Standard error
#SBATCH --time=01:00:00              # Walltime (hh:mm:ss)
#SBATCH --nodes=2                    # Number of nodes
#SBATCH --ntasks-per-node=16          # MPI ranks per node
#SBATCH --cpus-per-task=1            # CPU cores per MPI rank
#SBATCH --mem=250G                      # Use all memory on node
#SBATCH --mail-type=END,FAIL         # Notifications for job done & fail
#SBATCH --mail-user=fcastro@princeton.edu

# ---- Setup environment ----
module purge
module load anaconda3/2025.6   # adjust if different on Della
module load openmpi/gcc/4.1.6  # or whatever MPI version Della provides

# activate your conda environment (replace "desc-env" with yours)
source activate desc-ray

# ---- Run the Python MPI job ----
# Replace "run_bn_res_vec.py" with the script that imports and calls bn_res_vec_mpi
srun -n $(( $SLURM_NTASKS_PER_NODE * $SLURM_JOB_NUM_NODES )) \
     jupyter nbconvert --ExecutePreprocessor.timeout=None --to notebook --execute --inplace mpi.ipynb

